---
title: "Post-Surgery Resting Energy Expenditure"
author: "Sreya Gnanavel"
date: "2025-12-11"
output: 
  bookdown::pdf_document2:
    number_sections: true
    toc: false
---

# Background

Accurately assessing postoperative metabolic needs is critical for optimizing nutritional support and improving recovery outcomes in cardiac surgery patients. Resting energy expenditure (REE), measured using indirect calorimetry (IC), provides a direct estimate of metabolic demand, yet little is known about how REE changes throughout recovery or how it differs across clinically relevant factors such as obesity status, ventilator use, and hospital location. This study seeks to address these gaps by analyzing 35 repeated REE and REE/kg measurements collected from 11 cardiac surgery patients during their stays in the intensive care unit (ICU) and step-down unit (SDU). By characterizing patterns of energy expenditure across patients and over time, the goal of this analysis is to identify factors associated with increased metabolic demand and to generate insights that can support more tailored and effective postoperative nutritional care.

# Exploratory Data Analysis

To understand patterns in postoperative metabolic demand and to guide the structure of my final model, I first conducted a detailed exploratory analysis of REE and REE/kg across patients and clinical factors. The distributions of the two outcome variables (Figure @ref(fig:eda1)) show substantial heterogeneity, with REE moderately right-skewed and REE/kg more symmetric. This distinction suggests that absolute REE is strongly influenced by body size, while REE/kg provides a more standardized measure of metabolic intensity. The differences in distributional shape help continue analyzing both outcomes in parallel.

A key feature of the dataset is its repeated-measures structure. The REE Trajectories by Patient plot ((Figure @ref(fig:eda3)) displays a lot of within-patient correlation and highly individualized recovery profiles, with some patients showing rising REE over time while others decline or fluctuate. The Patient-Specific Mean REE plot (Figure @ref(fig:eda4)) further highlights large between-patient differences in average metabolic demand. Together, these figures provide strong justification for a mixed-effects model with patient-level random intercepts, as failing to account for this structure would underestimate variability and bias inference.

I also explored clinical covariates thought to influence metabolic rate. The boxplots comparing obese and non-obese patients (Figure @ref(fig:eda5)) and (Figure @ref(fig:eda6)) reveal that obese patients have substantially higher REE but lower REE/kg, consistent with known physiological patterns where larger bodies require more calories overall but expend less energy per kilogram. The REE by Ventilator Status plot (Figure @ref(fig:eda7)) shows that ventilated patients exhibit noticeably lower REE than those breathing spontaneously, suggesting ventilator use is an important predictor to include. Finally, the smoothed scatterplots of BMI against both REE and REE/kg (Figure @ref(fig:eda8)) and (Figure @ref(fig:eda9)) show nonlinear associations with BMI, reinforcing the relevance of body composition–related predictors.

# **Model Rationale and Implementation**

Taken together, the exploratory analysis shows that an appropriate modeling strategy must:\
(1) incorporate patient-level random effects due to strong within-patient correlation (Figure @ref(fig:eda3)) and (Figure @ref(fig:eda4)),\
(2) include Obesity and Ventilator status as fixed effects due to their clear associations with REE (Figures 5–9), and\
(3) analyze both REE and REE/kg given their distinct distributional behaviors (Figure @ref(fig:eda1)).

So this leads to using `lme4::lmer()` for a linear mixed-effects regression framework to characterize the effects of obesity, ventilator use, and clinical setting on postoperative metabolic demand. To assess the importance of individual predictors, nested model comparisons were conducted using Kenward–Roger F-tests implemented in `pbkrtest::KRmodcomp()`. Parallel models were fit for both REE and REE per kilogram (REE/kg) to evaluate whether conclusions changed when adjusting for body size.

Including BMI in the mixed-effects models was not appropriate because it does not vary within patients and is highly collinear with obesity status. Since the random intercept already captures between-patient differences, adding BMI would provide no additional information while introducing multicollinearity and unstable estimates.

I also evaluated whether ICU/SDU location should be retained in the final models. Although clinical location initially appeared to be a plausible predictor of postoperative metabolic demand, it was highly correlated with ventilator use, as most ventilated patients were in the ICU. This collinearity inflated standard errors and reduced Kenward–Roger degrees of freedom. Nested model comparisons confirmed that ICU/SDU did not significantly improve model fit for either REE (F = 0.31, p = 0.58) or REE/kg (F = 0.97, p = 0.34), and its coefficient was consistently small and non-significant across specifications. Given the limited sample size and lack of independent explanatory value, retaining ICU/SDU risked overfitting without contributing meaningful interpretability. Accordingly, ICU/SDU was removed from both final models, allowing obesity and ventilator status to be estimated more reliably.

To evaluate whether clinical effects varied across subgroups, I tested several interactions. Both the Obese x Ventilator and Obese x ICU/SDU interactions improved AIC substantially ($\Delta$AIC = –13.4 and –11.2), whereas Ventilator x ICU/SDU did not ($\Delta$AIC = 0) (Table @ref(tab:mod17)) . However, Kenward–Roger tests provided only marginal evidence for the strongest interaction (Obese x Ventilator: F = 3.10, p = 0.089), and the sample was too small to support the full interaction model despite its low AIC (Table @ref(tab:mod17)) . Overall, the AIC results suggest possible interactions, but the KR tests indicate insufficient statistical support. Therefore, the final models retained only the main effects of obesity and ventilator status:

$$
\text{REE}_{ij}
=
\beta_0
+ \beta_{\text{Obese}} \, \text{Obese}_{ij}
+ \beta_{\text{Vent}} \, \text{Vent}_{ij}
+ b_{0i}
+ \varepsilon_{ij},
$$

$$
b_{0i} \sim N(0, \sigma_b^2), \qquad 
\varepsilon_{ij} \sim N(0, \sigma^2).
$$

$$
\text{REE/kg}_{ij}
=
\beta_0
+ \beta_{\text{Obese}} \, \text{Obese}_{ij}
+ \beta_{\text{Vent}} \, \text{Vent}_{ij}
+ b_{0i}
+ \varepsilon_{ij},
$$

$$
b_{0i} \sim N(0, \sigma_b^2), \qquad 
\varepsilon_{ij} \sim N(0, \sigma^2).
$$

# Model Evaluation

A comprehensive set of diagnostic checks indicated that both mixed-effects models were appropriately specified. Residuals vs. fitted plots for REE and REE/kg showed centered residuals with no major systematic patterns, aside from mild heteroskedasticity at higher fitted values (Figures \@ref(fig:mod4), \@ref(fig:mod11)). Normal Q–Q plots revealed approximate residual normality with expected tail deviations given the small sample size (Figures \@ref(fig:mod5), \@ref(fig:mod12)). Q–Q plots of the patient-level random intercepts (Figures \@ref(fig:mod6), \@ref(fig:mod13)) further confirmed that the random effects were reasonably normally distributed, supporting the random-intercept structure.

Model fit statistics were summarized for the full REE and REE/kg mixed models. For the REE model, the marginal R² was 0.459, indicating that fixed effects explained about 46% of the variation in REE, while the conditional R² increased to 0.551 after accounting for patient-level random intercepts (Table \@ref(tab:mod15)). The adjusted ICC (0.171) showed that \~17% of REE variability was attributable to stable between-patient differences. In contrast, the REE/kg model had a much lower marginal R² (0.169), demonstrating limited explanatory power from fixed effects. However, its conditional R² rose to 0.565, and the adjusted ICC was substantially higher (0.476; Table \@ref(tab:mod16)), indicating strong patient-level clustering in REE/kg. Overall, total REE appears more driven by measured clinical factors, whereas REE/kg reflects larger inherent differences across individuals.

A few high REE observations (\>2400 kcal/day) increased random-effect variance but were not influential outliers. Mild heteroskedasticity and slight non-normality were expected given the limited sample size and did not threaten model validity. The strongest structural limitation was the temporal confounding between clinical variables and measurement order, as most “ICU” and “Ventilator” observations occurred early in recovery. However, this reflects the study design rather than data anomalies, and the mixed-effects framework handled this imbalance reasonably well.

# Model results

The mixed-effects model for REE showed that both obesity status and ventilator use were significant predictors of total metabolic expenditure. Obese patients exhibited approximately 472 kcal/day higher REE than non-obese patients (p = 0.013), consistent with exploratory patterns (Table \@ref(tab:mod1)). Ventilated patients demonstrated an estimated 405 kcal/day reduction in REE (p = 0.002), indicating markedly lower metabolic demand under mechanical ventilation (Table \@ref(tab:mod1)). Kenward–Roger tests confirmed the importance of both predictors: removing obesity significantly worsened model fit (F = 10.91, p = 0.0105), and removing ventilator status also led to a significant loss of fit (F = 9.95, p = 0.0036) (Tables \@ref(tab:mod2)–\@ref(tab:mod3)).

For REE/kg, the pattern differed. Obesity remained non-significant (p = 0.260), while ventilator use was associated with a modest but statistically significant decrease of 3.94 kcal/kg/day (p = 0.028) (Table \@ref(tab:mod8)). Model comparisons supported the relevance of ventilator status (F = 4.86, p = 0.0352) but provided no evidence that obesity improved fit in the REE/kg model (p = 0.2581) (Tables \@ref(tab:mod9)–\@ref(tab:mod10)). Thus, obesity and ventilator status meaningfully affect total energy expenditure but not energy expenditure per kilogram, indicating that differences in REE are driven by body size rather than intrinsic metabolic rate

Taken together, these results show that clinically meaningful increases in metabolic demand in obese patients arise from higher absolute energy expenditure, not from differences in metabolic rate per kilogram. Ventilator use, however, consistently reduces metabolic requirements across both scales.

# Shortcomings and Conclusion

This analysis is limited by the small sample size (35 observations across 11 patients), which reduces power and leads to unstable degrees of freedom for between-patient predictors such as obesity. ICU/SDU location and ventilator status are strongly tied to recovery stage, creating temporal confounding that the model cannot fully disentangle. Mild heteroskedasticity and slight non-normality in residuals indicate that assumptions are only approximately met, and a few high-REE patients may influence random-effect estimates. The absence of additional clinical covariates also limits the model’s ability to explain variation in metabolic demand. Future work should include larger, more balanced datasets and models that explicitly incorporate recovery time and richer clinical information.

The mixed-effects analysis showed that obesity and ventilator status significantly influence total REE, whereas clinical location (ICU vs. SDU) does not provide additional explanatory value. Obese patients had higher absolute metabolic demand, but this difference disappeared when adjusting for body weight, indicating similar metabolic rate per kilogram across obesity groups. Ventilated patients exhibited lower metabolic demand on both absolute and weight-adjusted scales. These conclusions were consistent with observed-versus-fitted plots, which showed tighter alignment for REE than for REE/kg (Figures \@ref(fig:mod7) and \@ref(fig:mod14)). Model diagnostics supported the use of a mixed-effects framework, though substantial within-patient variability remained, reflecting the dynamic nature of postoperative metabolism. Overall, these findings highlight the importance of individualized metabolic assessment to guide postoperative nutritional support.

\newpage

# Appendix

```{r echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(lme4)
library(lmerTest)  
library(ggplot2)
library(performance)
library(lattice)
library(pbkrtest)
library(kableExtra)
library(broom.mixed)
library(patchwork)

# Load data
load("REE.RData")
```

```{r mutate_data, cache=TRUE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}

REE <- REE |>
  mutate(
    ID = factor(ID),
    Measurement = factor(Measurement),
    Obese = factor(Obese, levels = c(0,1), labels = c("Non-Obese","Obese")),
    Ventilator = factor(Ventilator, levels = c(0,1), labels = c("NoVent","Vent")),
    ICUorSDU = factor(ICUorSDU)   # <-- FIXED
  )
```

```{r label = "eda1", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Distribution of REE and REE/kg across patients", fig.show = 'hold'}

p1 <- ggplot(REE, aes(x = REE)) +
  geom_histogram(bins = 20, fill = "#4E79A7", color = "white") +
  labs(title = "Distribution of REE", x = "Resting Energy Expenditure")

p2 <- ggplot(REE, aes(x = REEperKG)) +
  geom_histogram(bins = 20, fill = "#F28E2B", color = "white") +
  labs(title = "Distribution of REE per KG", x = "REE per KG")

p1 + p2
```

```{r label = "eda3", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE by Patient showing within-patient correlation & between-patient variability", fig.show = 'hold'}

ggplot(REE, aes(x = Measurement, y = REE, group = ID, color = Obese)) +
  geom_line(alpha = 0.7) +
  geom_point(size = 2) +
  labs(title = "REE Trajectories by Patient")
```

```{r label = "eda4", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Mean REE by Patient Mean", fig.show = 'hold'}

patient_means <- REE |>
  group_by(ID) |>
  summarise(mean_REE = mean(REE))

ggplot(patient_means, aes(x = reorder(ID, mean_REE), y = mean_REE)) +
  geom_point(size = 3) +
  geom_hline(yintercept = mean(REE$REE), linetype = "dashed", color = "red") +
  labs(title = "Patient-Specific Mean REE", x = "Patient ID", y = "Mean REE")
```

```{r label = "eda5", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE by Non-Obese & Obese Patients", fig.show = 'hold'}
ggplot(REE, aes(x = Obese, y = REE, fill = Obese)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "REE by Obesity Status", x = "", y = "REE")
```

```{r label = "eda6", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE per KG by Non-Obese and Obese Patients", fig.show = 'hold'}
ggplot(REE, aes(x = Obese, y = REEperKG, fill = Obese)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "REE per KG by Obesity Status", x = "", y = "REE per KG")
```

```{r label = "eda7", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE by Ventilator Status for Obese and Non-Obese Patients", fig.show = 'hold'}

ggplot(REE, aes(Ventilator, REE, fill = Ventilator)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "REE by Ventilator Status", y = "REE")

```

```{r label = "eda8", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE vs BMI fit with a LOESS curve", fig.show = 'hold'}
ggplot(REE, aes(BMI, REE)) +
  geom_point(alpha = 0.7) + geom_smooth(method = "loess") +
  labs(title = "REE vs BMI")
```

```{r label = "eda9", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE per KG vs BMI fit with a LOESS curve", fig.show = 'hold'}

ggplot(REE, aes(BMI, REEperKG)) +
  geom_point(alpha = 0.7) + geom_smooth(method = "loess") +
  labs(title = "REE per KG vs BMI")
```

### Modeling:

```{r label = "mod1", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Fixed Effects for REE Mixed Model", fig.show = 'hold'}

model_REE <- lmer(
  REE ~ Obese + Ventilator + (1 | ID),
  data = REE
)

tidy(model_REE, effects = "fixed", conf.int = TRUE) %>%
  kable("latex", digits = 3, caption = "Fixed Effects for REE Mixed Model") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod2", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "KR Test Full Model vs. Model without Obesity", fig.show = 'hold'}

model_REE_noObese <- lmer(REE ~ Ventilator + (1|ID), data = REE)

kr <- pbkrtest::KRmodcomp(model_REE, model_REE_noObese)

broom::tidy(kr) %>%
  kable("latex",
        digits = 4,
        caption = "Kenward–Roger Test Comparing Full Model REE vs. Model without Obesity") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod3", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "KR Test Full Model vs. Model without Ventilator", fig.show = 'hold'}

model_REE_noVent <- lmer(REE ~ Obese + (1|ID), data = REE)
kr <- pbkrtest::KRmodcomp(model_REE, model_REE_noVent)

broom::tidy(kr) %>%
  kable("latex",
        digits = 4,
        caption = "Kenward–Roger Test Comparing Full Model REE vs. Model without Ventilator") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod4", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Residuals vs Fitted Plot for full REE model", fig.show = 'hold'}

par(mfrow=c(1,2))
plot(model_REE, which=1, main = "Residuals vs Fitted for REE")  

```

```{r label = "mod5", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Normal QQ Plot for full REE model", fig.show = 'hold'}

qqnorm(resid(model_REE)); qqline(resid(model_REE))
par(mfrow=c(1,1))
```

```{r label = "mod6", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Random Intercept QQ Plot for full REE model", fig.show = 'hold'}

qqnorm(ranef(model_REE)$ID[,1], main="Random Intercept QQ Plot")
qqline(ranef(model_REE)$ID[,1])
```

```{r label = "mod7", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Observed vs Fitted REE by Patient ID", fig.show = 'hold'}

REE$fitted <- fitted(model_REE)

ggplot(REE, aes(x = fitted, y = REE, color = ID)) +
  geom_point() +
  geom_abline(slope=1, intercept=0, linetype="dashed") +
  labs(title = "Observed vs Fitted REE", x = "Fitted", y = "Observed") 

```

```{r label = "mod8", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Fixed Effects for REE by KG Mixed Model", fig.show = 'hold'}

model_REEkg <- lmer(
  REEperKG ~ Obese + Ventilator  + (1 | ID),
  data = REE
)

tidy(model_REEkg, effects = "fixed", conf.int = TRUE) %>%
  kable("latex", digits = 3, caption = "Fixed Effects for REE/kg Mixed Model") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod9", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "KR Test Full Model REEkg vs. Model without Obesity", fig.show = 'hold'}

model_REEkg_noObese <- lmer(REEperKG ~ Ventilator + (1|ID), data = REE)

kr <- pbkrtest::KRmodcomp(model_REEkg, model_REEkg_noObese)

broom::tidy(kr) %>%
  kable("latex",
        digits = 4,
        caption = "Kenward–Roger Test Comparing Full Model REE/kg vs. Model without Obesity") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod10", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "KR Test Full Model REEkg vs. Model without Ventilator", fig.show = 'hold'}

model_REEkg_noVent <- lmer(REEperKG ~ Obese + (1|ID), data = REE)

kr <- pbkrtest::KRmodcomp(model_REEkg, model_REEkg_noVent)

broom::tidy(kr) %>%
  kable("latex",
        digits = 4,
        caption = "Kenward–Roger Test Comparing Full Model REE/kg vs. Model without Ventilator") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod11", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Residual Plot for REE per KG model", fig.show = 'hold'}

par(mfrow=c(1,2))
plot(model_REEkg, which=1, main = "Residuals vs Fitted for REE/kg")
```

```{r label = "mod12", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "QQ Plot for REE per KG model", fig.show = 'hold'}

qqnorm(resid(model_REEkg)); qqline(resid(model_REEkg))
par(mfrow=c(1,1))
```

```{r label = "mod13", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Random Intercept QQ Plot for REE per KG model", fig.show = 'hold'}

qqnorm(ranef(model_REEkg)$ID[,1], main="Random Intercept QQ Plot (REE/kg)")
qqline(ranef(model_REEkg)$ID[,1])
```

```{r label = "mod14", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Observed vs Fitted REE per KG by Patient ID", fig.show = 'hold'}

REE$fitted_kg <- fitted(model_REEkg)

ggplot(REE, aes(x = fitted_kg, y = REEperKG, color = ID)) +
  geom_point() +
  geom_abline(slope=1, intercept=0, linetype="dashed") +
  labs(title = "Observed vs Fitted REE per KG", x = "Fitted", y = "Observed") 

```

```{r label = "mod15", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "R^2 & ICC values for the full REE model", fig.show = 'hold'}

r2_vals  <- performance::r2(model_REE)
icc_vals <- performance::icc(model_REE)

fit_stats <- data.frame(
  Metric = c("Marginal R²", "Conditional R²", "Adjusted ICC", "Unadjusted ICC"),
  Value  = c(r2_vals$R2_marginal,
             r2_vals$R2_conditional,
             icc_vals$ICC_adjusted,
             icc_vals$ICC_unadjusted)
)

kable(fit_stats, 
      format = "latex",
      digits = 3,
      caption = "Model Fit Statistics for Full REE Mixed Model",
      booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position")
```

```{r label = "mod16", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "ICC values for the full REE/kg model", fig.show = 'hold'}

r2_vals  <- performance::r2(model_REEkg)
icc_vals <- performance::icc(model_REEkg)

fit_stats <- data.frame(
  Metric = c("Marginal R²", "Conditional R²", "Adjusted ICC", "Unadjusted ICC"),
  Value  = c(r2_vals$R2_marginal,
             r2_vals$R2_conditional,
             icc_vals$ICC_adjusted,
             icc_vals$ICC_unadjusted)
)

kable(fit_stats, 
      format = "latex",
      digits = 3,
      caption = "Model Fit Statistics for Full REE/kg Mixed Model",
      booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position")

```

```{r label = "mod17", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "AIC Values with Different Interactions Terms Compared to the the Original Model", fig.show = 'hold'}

model_REE_int1 <- lmer(
  REE ~ Obese * Ventilator + ICUorSDU + (1 | ID),
  data = REE
)

model_REE_int2 <- lmer(
  REE ~ Obese * ICUorSDU + Ventilator + (1 | ID),
  data = REE
)


model_REE_int3 <- lmer(
  REE ~ Ventilator * ICUorSDU + Obese + (1 | ID),
  data = REE
)

model_REE_fullInt <- lmer(
  REE ~ Obese * Ventilator * ICUorSDU + (1 | ID),
  data = REE
)

# Collect models into a named list
model_list <- list(
  MainEffects = model_REE,
  Obese_x_Vent = model_REE_int1,
  Obese_x_Location = model_REE_int2,
  Vent_x_Location = model_REE_int3,
  Full_Interaction = model_REE_fullInt
)

# Build a clean AIC table
aic_table <- map_df(
  names(model_list),
  ~ data.frame(
      Model = .x,
      AIC = AIC(model_list[[.x]])
  )
) %>%
  mutate(AIC = round(AIC, 3))

# Print nicely
kable(
  aic_table,
  format = "latex",
  booktabs = TRUE,
  caption = "AIC Comparison of Interaction Models"
) %>%
  kable_styling(latex_options = c("hold_position", "striped"))
```
