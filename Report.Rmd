---
title: "Post-Surgery Resting Energy Expenditure"
author: "Sreya Gnanavel"
date: "2025-12-11"
output: 
  bookdown::pdf_document2:
    number_sections: true
    toc: false
---

# Background

Accurately assessing postoperative metabolic needs is critical for optimizing nutritional support and improving recovery outcomes in cardiac surgery patients. Resting energy expenditure (REE), measured using indirect calorimetry (IC), provides a direct estimate of metabolic demand, yet little is known about how REE changes throughout recovery or how it differs across clinically relevant factors such as obesity status, ventilator use, and hospital location. This study seeks to address these gaps by analyzing 35 repeated REE and REE/kg measurements collected from 11 cardiac surgery patients during their stays in the intensive care unit (ICU) and step-down unit (SDU). By characterizing patterns of energy expenditure across patients and over time, the goal of this analysis is to identify factors associated with increased metabolic demand and to generate insights that can support more tailored and effective postoperative nutritional care.

# Exploratory Data Analysis

To understand patterns in postoperative metabolic demand and to guide the structure of my final model, I first conducted a detailed exploratory analysis of REE and REE/kg across patients and clinical factors. The distributions of the two outcome variables (Figure @ref(fig:eda1)) and (Figure @ref(fig:eda2)) show substantial heterogeneity, with REE moderately right-skewed and REE/kg more symmetric. This distinction suggests that absolute REE is strongly influenced by body size, while REE/kg provides a more standardized measure of metabolic intensity. The differences in distributional shape motivate analyzing both outcomes in parallel.

A key feature of the dataset is its repeated-measures structure. The REE Trajectories by Patient plot ((Figure @ref(fig:eda3)) displays considerable within-patient correlation and highly individualized recovery profiles, with some patients showing rising REE over time while others decline or fluctuate. The Patient-Specific Mean REE plot (Figure @ref(fig:eda4)) further highlights large between-patient differences in average metabolic demand. Together, these figures provide strong justification for a mixed-effects model with patient-level random intercepts, as failing to account for this structure would underestimate variability and bias inference.

We also explored clinical covariates thought to influence metabolic rate. The boxplots comparing obese and non-obese patients (Figure @ref(fig:eda5)) and (Figure @ref(fig:eda6)) reveal that obese patients have substantially higher REE but lower REE/kg, consistent with known physiological patterns where larger bodies require more calories overall but expend less energy per kilogram. The REE by Ventilator Status plot (Figure @ref(fig:eda7)) shows that ventilated patients exhibit noticeably lower REE than those breathing spontaneously, suggesting ventilator use is an important predictor to include. Finally, the smoothed scatterplots of BMI against both REE and REE/kg (Figure @ref(fig:eda8)) and (Figure @ref(fig:eda9)) show nonlinear associations with BMI, reinforcing the relevance of body composition–related predictors.

# **Model Rationale and Implementation**

Taken together, the exploratory analysis shows that an appropriate modeling strategy must:\
(1) incorporate patient-level random effects due to strong within-patient correlation (Figure @ref(fig:eda3)) and (Figure @ref(fig:eda4)),\
(2) include Obesity, BMI, and Ventilator status as fixed effects due to their clear associations with REE (Figures 5–9), and\
(3) analyze both REE and REE/kg given their distinct distributional behaviors (Figure @ref(fig:eda1)) and (Figure @ref(fig:eda2)).

So these leads to using `lme4::lmer()` for a linear mixed-effects regression framework to characterize the effects of obesity, ventilator use, and clinical setting on postoperative metabolic demand. To assess the importance of individual predictors, nested model comparisons were conducted using Kenward–Roger F-tests implemented in `pbkrtest::KRmodcomp()`. Parallel models were fit for both REE and REE per kilogram (REE/kg) to evaluate whether conclusions changed when adjusting for body size.

# Model Evaluation

A full set of diagnostic checks confirmed that the mixed-effects models were reasonably well-specified. The Residuals vs Fitted plots for both REE and REE/kg showed centered residuals with only mild heteroskedasticity at higher fitted values. Normal Q–Q plots of residuals exhibited approximate normality with some tail deviation expected from the small sample size, and random-intercept Q–Q plots demonstrated that the patient-specific effects were approximately normally distributed. Observed vs fitted plots showed that the models captured meaningful variation in the outcomes, and posterior predictive density overlays indicated that the REE model in particular reproduced the empirical distribution well. No major anomalies or assumption violations were detected. Overall, diagnostics supported the adequacy of the chosen modeling framework for both REE and REE/kg.

# Model results

The first model used REE (kcal/day) as the outcome. Obesity was as the strongest predictor, with obese patients exhibiting approximately 488 kcal/day higher REE (p = 0.011), consistent with the REE by Obesity Status boxplot. Ventilator use was associated with a 340 kcal/day reduction in REE (p = 0.048), mirroring the REE by Ventilator Status figure. ICU vs SDU location showed no meaningful difference (p = 0.56), consistent with the exploratory comparisons. Nested model comparisons using Kenward–Roger F-tests confirmed these results: removing obesity significantly worsened model fit (p = 0.009), removing ventilator status had borderline impact (p = 0.065), and removing location did not affect the model (p = 0.58). Together, these results show that total REE is driven primarily by obesity status, modestly by ventilator use, and not by patient location.

To evaluate whether these findings reflected true metabolic differences or simply differences in body size, we fit an identical mixed-effects model using weight-adjusted REE (REE/kg) as the outcome. In this model, none of the predictors were significant, and all KRmodcomp tests showed no loss of fit when any predictor was removed. These results directly aligned with the REE per KG by Obesity Status plot, where obese and non-obese patients showed strongly overlapping distributions. Thus, the conclusions differ for REE/kg: once body weight is accounted for, obesity and ventilator status no longer explain variation in metabolic rate. Obese patients have higher total REE, but not higher REE per kilogram of body mass.

The mixed-effects model for REE revealed that obesity status and ventilator use were meaningful predictors of total metabolic expenditure. Obese patients exhibited **approximately 488 kcal/day higher REE** than non-obese patients (p = 0.011), consistent with exploratory patterns. Ventilated patients showed an estimated **340 kcal/day reduction** in REE (p = 0.048), reflecting lower metabolic demand under mechanical ventilation. ICU vs SDU location demonstrated no detectable association with REE (p = 0.564). Kenward–Roger tests confirmed these findings: removing obesity significantly worsened model fit (p = 0.009), while removing ventilator status produced borderline evidence of loss of fit (p = 0.065), and removing location had no effect (p = 0.58). When REE was weight-adjusted, the conclusions changed substantially. In the REE/kg model, **none of the predictors were significant**, and no nested model comparison indicated loss of fit, consistent with the strong overlap seen in the *REE per KG by Obesity Status* plot. Thus, obesity and ventilator status meaningfully affect **total** energy expenditure but **not** energy expenditure per kilogram, indicating that differences in REE are driven by body size rather than intrinsic metabolic rate.

In summary, the modeling objectives were fully achieved. Using a properly diagnosed mixed-effects framework, we characterized how REE depends on obesity, ventilator use, and location; we demonstrated that these conclusions change when REE is weight-adjusted; and we verified through residual, random-effect, and predictive diagnostics that the models fit the data appropriately. The final results show that obesity and ventilator status meaningfully affect total REE, but do not influence REE/kg, highlighting that metabolic rate per unit mass is stable across patient groups.

# Shortcomings and Conclusion

\newpage

# Appendix

```{r echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(lme4)
library(lmerTest)  
library(ggplot2)
library(performance)
library(lattice)
library(pbkrtest)
library(kableExtra)
library(broom.mixed)
# Load data
load("REE.RData")
```

```{r mutate_data, cache=TRUE, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}

REE <- REE |>
  mutate(
    ID = factor(ID),
    Measurement = factor(Measurement),
    Obese = factor(Obese, levels = c(0,1), labels = c("Non-Obese","Obese")),
    Ventilator = factor(Ventilator, levels = c(0,1), labels = c("NoVent","Vent")),
    ICUorSDU = factor(ICUorSDU)   # <-- FIXED
  )
```

```{r label = "eda1", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Distribution of REE across patients", fig.show = 'hold'}

ggplot(REE, aes(x = REE)) +
  geom_histogram(bins = 20, fill = "#4E79A7", color = "white") +
  labs(title = "Distribution of REE", x = "Resting Energy Expenditure")
```

```{r label = "eda2", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Distribution of REE per KG across patients", fig.show = 'hold'}

ggplot(REE, aes(x = REEperKG)) +
  geom_histogram(bins = 20, fill = "#F28E2B", color = "white") +
  labs(title = "Distribution of REE per KG", x = "REE per KG")

```

```{r label = "eda3", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE by Patient showing within-patient correlation & between-patient variability", fig.show = 'hold'}

ggplot(REE, aes(x = Measurement, y = REE, group = ID, color = Obese)) +
  geom_line(alpha = 0.7) +
  geom_point(size = 2) +
  labs(title = "REE Trajectories by Patient")
```

```{r label = "eda4", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Mean REE by Patient Mean", fig.show = 'hold'}

patient_means <- REE |>
  group_by(ID) |>
  summarise(mean_REE = mean(REE))

ggplot(patient_means, aes(x = reorder(ID, mean_REE), y = mean_REE)) +
  geom_point(size = 3) +
  geom_hline(yintercept = mean(REE$REE), linetype = "dashed", color = "red") +
  labs(title = "Patient-Specific Mean REE", x = "Patient ID", y = "Mean REE")
```

```{r label = "eda5", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE by Non-Obese & Obese Patients", fig.show = 'hold'}
ggplot(REE, aes(x = Obese, y = REE, fill = Obese)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "REE by Obesity Status", x = "", y = "REE")
```

```{r label = "eda6", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE per KG by Non-Obese and Obese Patients", fig.show = 'hold'}
ggplot(REE, aes(x = Obese, y = REEperKG, fill = Obese)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "REE per KG by Obesity Status", x = "", y = "REE per KG")
```

```{r label = "eda7", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE by Ventilator Status for Obese and Non-Obese Patients", fig.show = 'hold'}

ggplot(REE, aes(Ventilator, REE, fill = Ventilator)) +
  geom_boxplot(alpha = 0.8) +
  labs(title = "REE by Ventilator Status", y = "REE")

```

```{r label = "eda8", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE vs BMI fit with a LOESS curve", fig.show = 'hold'}
ggplot(REE, aes(BMI, REE)) +
  geom_point(alpha = 0.7) + geom_smooth(method = "loess") +
  labs(title = "REE vs BMI")
```

```{r label = "eda9", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "REE per KG vs BMI fit with a LOESS curve", fig.show = 'hold'}

ggplot(REE, aes(BMI, REEperKG)) +
  geom_point(alpha = 0.7) + geom_smooth(method = "loess") +
  labs(title = "REE per KG vs BMI")
```

### Modeling: 

```{r label = "mod1", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "Fixed Effects for REE Mixed Model", fig.show = 'hold'}

model_REE <- lmer(
  REE ~ Obese + Ventilator + ICUorSDU + (1 | ID),
  data = REE
)

tidy(model_REE, effects = "fixed", conf.int = TRUE) %>%
  kable("latex", digits = 3, caption = "Fixed Effects for REE Mixed Model") %>%
  kable_styling(full_width = FALSE)
```

```{r label = "mod2", echo = FALSE, warning = FALSE, message = FALSE, fig.cap = "KR Test Full Model vs. Model without Obesity", fig.show = 'hold'}

model_REE_noObese <- lmer(REE ~ Ventilator + ICUorSDU + (1|ID), data = REE)

kr <- pbkrtest::KRmodcomp(model_REE, model_REE_noObese)

broom::tidy(kr) %>%
  kable("latex",
        digits = 4,
        caption = "Kenward–Roger Test Comparing Full Model vs. Model without Obesity") %>%
  kable_styling(full_width = FALSE)
```

```{r}
model_REE_noVent <- lmer(REE ~ Obese + ICUorSDU + (1|ID), data = REE)
pbkrtest::KRmodcomp(model_REE, model_REE_noVent)
```

```{r}
model_REE_noLoc <- lmer(REE ~ Obese + Ventilator + (1|ID), data = REE)
pbkrtest::KRmodcomp(model_REE, model_REE_noLoc)
```

```{r}
par(mfrow=c(1,2))
plot(model_REE, which=1)  # residuals vs fitted
qqnorm(resid(model_REE)); qqline(resid(model_REE))
par(mfrow=c(1,1))

```

```{r}
qqnorm(ranef(model_REE)$ID[,1], main="Random Intercept QQ Plot")
qqline(ranef(model_REE)$ID[,1])

```

```{r}
check_model(model_REE)

```

```{r}
REE$fitted <- fitted(model_REE)

ggplot(REE, aes(x = fitted, y = REE, color = ID)) +
  geom_point() +
  geom_abline(slope=1, intercept=0, linetype="dashed") +
  labs(title = "Observed vs Fitted REE", x = "Fitted", y = "Observed") +
  theme(legend.position = "none")

```

```{r}
model_REEkg <- lmer(
  REEperKG ~ Obese + Ventilator + ICUorSDU + (1 | ID),
  data = REE
)

summary(model_REEkg)

```

```{r}
model_REEkg_noObese <- lmer(REEperKG ~ Ventilator + ICUorSDU + (1|ID), data = REE)
pbkrtest::KRmodcomp(model_REEkg, model_REEkg_noObese)

```

```{r}
model_REEkg_noVent <- lmer(REEperKG ~ Obese + ICUorSDU + (1|ID), data = REE)
pbkrtest::KRmodcomp(model_REEkg, model_REEkg_noVent)

```

```{r}
model_REEkg_noLoc <- lmer(REEperKG ~ Obese + Ventilator + (1|ID), data = REE)
pbkrtest::KRmodcomp(model_REEkg, model_REEkg_noLoc)

```

```{r}
par(mfrow=c(1,2))
plot(model_REEkg, which=1)
qqnorm(resid(model_REEkg)); qqline(resid(model_REEkg))
par(mfrow=c(1,1))

qqnorm(ranef(model_REEkg)$ID[,1], main="Random Intercept QQ Plot (REE/kg)")
qqline(ranef(model_REEkg)$ID[,1])

check_model(model_REEkg)

```

```{r}
REE$fitted_kg <- fitted(model_REEkg)

ggplot(REE, aes(x = fitted_kg, y = REEperKG, color = ID)) +
  geom_point() +
  geom_abline(slope=1, intercept=0, linetype="dashed") +
  labs(title = "Observed vs Fitted REE per KG", x = "Fitted", y = "Observed") +
  theme(legend.position = "none")

```
